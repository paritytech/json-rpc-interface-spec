<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>archive_v1_storageDiff</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../objectives.html"><strong aria-hidden="true">1.1.</strong> Objectives</a></li><li class="chapter-item expanded "><a href="../why-json-rpc.html"><strong aria-hidden="true">1.2.</strong> Why JSON-RPC?</a></li><li class="chapter-item expanded "><a href="../grouping-functions-and-node-capabilities.html"><strong aria-hidden="true">1.3.</strong> Grouping functions and node capabilities</a></li><li class="chapter-item expanded "><a href="../dos-attacks-resilience.html"><strong aria-hidden="true">1.4.</strong> DoS attacks resilience</a></li><li class="chapter-item expanded "><a href="../load-balancers.html"><strong aria-hidden="true">1.5.</strong> Load balancers</a></li></ol></li><li class="chapter-item expanded "><a href="../api.html"><strong aria-hidden="true">2.</strong> API specification</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../api/archive.html"><strong aria-hidden="true">2.1.</strong> archive</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../api/archive_v1_body.html"><strong aria-hidden="true">2.1.1.</strong> archive_v1_body</a></li><li class="chapter-item expanded "><a href="../api/archive_v1_call.html"><strong aria-hidden="true">2.1.2.</strong> archive_v1_call</a></li><li class="chapter-item expanded "><a href="../api/archive_v1_finalizedHeight.html"><strong aria-hidden="true">2.1.3.</strong> archive_v1_finalizedHeight</a></li><li class="chapter-item expanded "><a href="../api/archive_v1_genesisHash.html"><strong aria-hidden="true">2.1.4.</strong> archive_v1_genesisHash</a></li><li class="chapter-item expanded "><a href="../api/archive_v1_hashByHeight.html"><strong aria-hidden="true">2.1.5.</strong> archive_v1_hashByHeight</a></li><li class="chapter-item expanded "><a href="../api/archive_v1_header.html"><strong aria-hidden="true">2.1.6.</strong> archive_v1_header</a></li><li class="chapter-item expanded "><a href="../api/archive_v1_stopStorage.html"><strong aria-hidden="true">2.1.7.</strong> archive_v1_stopStorage</a></li><li class="chapter-item expanded "><a href="../api/archive_v1_stopStorageDiff.html"><strong aria-hidden="true">2.1.8.</strong> archive_v1_stopStorageDiff</a></li><li class="chapter-item expanded "><a href="../api/archive_v1_storage.html"><strong aria-hidden="true">2.1.9.</strong> archive_v1_storage</a></li><li class="chapter-item expanded "><a href="../api/archive_v1_storageDiff.html" class="active"><strong aria-hidden="true">2.1.10.</strong> archive_v1_storageDiff</a></li></ol></li><li class="chapter-item expanded "><a href="../api/chainHead.html"><strong aria-hidden="true">2.2.</strong> chainHead</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../api/chainHead_v1_body.html"><strong aria-hidden="true">2.2.1.</strong> chainHead_v1_body</a></li><li class="chapter-item expanded "><a href="../api/chainHead_v1_call.html"><strong aria-hidden="true">2.2.2.</strong> chainHead_v1_call</a></li><li class="chapter-item expanded "><a href="../api/chainHead_v1_continue.html"><strong aria-hidden="true">2.2.3.</strong> chainHead_v1_continue</a></li><li class="chapter-item expanded "><a href="../api/chainHead_v1_follow.html"><strong aria-hidden="true">2.2.4.</strong> chainHead_v1_follow</a></li><li class="chapter-item expanded "><a href="../api/chainHead_v1_header.html"><strong aria-hidden="true">2.2.5.</strong> chainHead_v1_header</a></li><li class="chapter-item expanded "><a href="../api/chainHead_v1_stopOperation.html"><strong aria-hidden="true">2.2.6.</strong> chainHead_v1_stopOperation</a></li><li class="chapter-item expanded "><a href="../api/chainHead_v1_storage.html"><strong aria-hidden="true">2.2.7.</strong> chainHead_v1_storage</a></li><li class="chapter-item expanded "><a href="../api/chainHead_v1_unfollow.html"><strong aria-hidden="true">2.2.8.</strong> chainHead_v1_unfollow</a></li><li class="chapter-item expanded "><a href="../api/chainHead_v1_unpin.html"><strong aria-hidden="true">2.2.9.</strong> chainHead_v1_unpin</a></li></ol></li><li class="chapter-item expanded "><a href="../api/chainSpec.html"><strong aria-hidden="true">2.3.</strong> chainSpec</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../api/chainSpec_v1_chainName.html"><strong aria-hidden="true">2.3.1.</strong> chainSpec_v1_chainName</a></li><li class="chapter-item expanded "><a href="../api/chainSpec_v1_genesisHash.html"><strong aria-hidden="true">2.3.2.</strong> chainSpec_v1_genesisHash</a></li><li class="chapter-item expanded "><a href="../api/chainSpec_v1_properties.html"><strong aria-hidden="true">2.3.3.</strong> chainSpec_v1_properties</a></li></ol></li><li class="chapter-item expanded "><a href="../api/rpc.html"><strong aria-hidden="true">2.4.</strong> rpc</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../api/rpc_methods.html"><strong aria-hidden="true">2.4.1.</strong> rpc_methods</a></li></ol></li><li class="chapter-item expanded "><a href="../api/sudo.html"><strong aria-hidden="true">2.5.</strong> sudo</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../api/sudo_unstable_p2pDiscover.html"><strong aria-hidden="true">2.5.1.</strong> sudo_unstable_p2pDiscover</a></li><li class="chapter-item expanded "><a href="../api/sudo_unstable_pendingTransactions.html"><strong aria-hidden="true">2.5.2.</strong> sudo_unstable_pendingTransactions</a></li><li class="chapter-item expanded "><a href="../api/sudo_unstable_version.html"><strong aria-hidden="true">2.5.3.</strong> sudo_unstable_version</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.6.</strong> sudo_network</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../api/sudo_network_unstable_unwatch.html"><strong aria-hidden="true">2.6.1.</strong> sudo_network_unstable_unwatch</a></li><li class="chapter-item expanded "><a href="../api/sudo_network_unstable_watch.html"><strong aria-hidden="true">2.6.2.</strong> sudo_network_unstable_watch</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.7.</strong> sudo_sessionKeys</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../api/sudo_sessionKeys_unstable_generate.html"><strong aria-hidden="true">2.7.1.</strong> sudo_sessionKeys_unstable_generate</a></li></ol></li><li class="chapter-item expanded "><a href="../api/transaction.html"><strong aria-hidden="true">2.8.</strong> transaction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../api/transaction_v1_broadcast.html"><strong aria-hidden="true">2.8.1.</strong> transaction_v1_broadcast</a></li><li class="chapter-item expanded "><a href="../api/transaction_v1_stop.html"><strong aria-hidden="true">2.8.2.</strong> transaction_v1_stop</a></li></ol></li><li class="chapter-item expanded "><a href="../api/transactionWatch.html"><strong aria-hidden="true">2.9.</strong> transactionWatch</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../api/transactionWatch_v1_submitAndWatch.html"><strong aria-hidden="true">2.9.1.</strong> transactionWatch_v1_submitAndWatch</a></li><li class="chapter-item expanded "><a href="../api/transactionWatch_v1_unwatch.html"><strong aria-hidden="true">2.9.2.</strong> transactionWatch_v1_unwatch</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="archive_v1_storagediff"><a class="header" href="#archive_v1_storagediff">archive_v1_storageDiff</a></h1>
<p><strong>Parameters</strong>:</p>
<ul>
<li>
<p><code>hash</code>: String containing a hexadecimal-encoded hash of the header of the block whose storage difference will be retrieved.</p>
</li>
<li>
<p><code>items</code>: Array of objects. The structure of these objects is found below.</p>
<pre><code class="language-json">&quot;items&quot;: [
    {
        &quot;key&quot;: &quot;0x...&quot;,
        &quot;returnType&quot;: &quot;value&quot; | &quot;hash&quot;,
        &quot;childTrieKey&quot;: &quot;0x...&quot;,
    },
]
</code></pre>
<p>If the <code>items</code> parameter is not provided, the storage difference is calculated for all keys of the main storage trie.</p>
<p>Each element in <code>items</code> must be an object containing the following fields:</p>
<ul>
<li><code>key</code> (optional): String containing a hexadecimal-encoded key prefix. Only the storage entries whose key starts with the provided prefix are returned. If this field is not present, the storage difference is calculated for all keys of the trie.</li>
<li><code>returnType</code>: String indicating the return type of the storage under the given <code>key</code>. The possible values are:
<ul>
<li><code>value</code>: The result contains the hexadecimal-encoded value of the storage entry.</li>
<li><code>hash</code>: The result contains the hexadecimal-encoded hash of the storage entry.</li>
</ul>
</li>
<li><code>childTrieKey</code> (optional): String containing the hexadecimal-encoded key of the child trie of the &quot;default&quot; namespace. If this field is not present, the storage difference is calculated for the main storage trie.</li>
</ul>
</li>
<li>
<p><code>previousHash</code> (optional): String containing a hexadecimal-encoded hash of the header of the block from which the storage difference will be calculated. The <code>previousHash</code> must be an ancestor of the provided <code>hash</code>.  When this parameter is provided, the storage difference is calculated between the <code>hash</code> block and the <code>previousHash</code> block. If this parameter is not provided, the storage difference is calculated between the <code>hash</code> block and the parent of the <code>hash</code> block.</p>
</li>
</ul>
<p><strong>Return value</strong>: String containing an opaque value representing the operation.</p>
<h2 id="notifications-format"><a class="header" href="#notifications-format">Notifications format</a></h2>
<p>This function will later generate one or more notifications in the following format:</p>
<pre><code class="language-json">{
    &quot;jsonrpc&quot;: &quot;2.0&quot;,
    &quot;method&quot;: &quot;archive_v1_storageDiffEvent&quot;,
    &quot;params&quot;: {
        &quot;subscription&quot;: &quot;...&quot;,
        &quot;result&quot;: ...
    }
}
</code></pre>
<p>Where <code>subscription</code> is the value returned by this function, and <code>result</code> can be one of:</p>
<h3 id="storagediff"><a class="header" href="#storagediff">storageDiff</a></h3>
<pre><code class="language-json">{
    &quot;event&quot;: &quot;storageDiff&quot;,
    &quot;key&quot;: &quot;0x...&quot;,
    &quot;value&quot;: &quot;0x...&quot;,
    &quot;hash&quot;: &quot;0x...&quot;,
    &quot;type&quot;: &quot;added&quot; | &quot;modified&quot; | &quot;deleted&quot;,
    &quot;childTrieKey&quot;: &quot;0x...&quot;,
}
</code></pre>
<p>The <code>storageDiff</code> event is generated for each storage difference between the two blocks.</p>
<ul>
<li>
<p><code>key</code>: String containing the hexadecimal-encoded key of the storage entry. A prefix of this key may have been provided in the items input.</p>
</li>
<li>
<p><code>value</code> (optional): String containing the hexadecimal-encoded value of the storage entry. This field is present when the <code>returnType</code> field in the <code>items</code> parameter is set to <code>value</code>.</p>
</li>
<li>
<p><code>hash</code> (optional): String containing the hexadecimal-encoded hash of the storage entry. This field is present when the <code>returnType</code> field in the <code>items</code> parameter is set to <code>hash</code>.</p>
</li>
<li>
<p><code>type</code>: String indicating the type of the storage difference. The possible values are:</p>
<ul>
<li><code>added</code>: The storage entry was added.</li>
<li><code>modified</code>: The storage entry was modified.</li>
<li><code>deleted</code>: The storage entry was deleted.</li>
</ul>
</li>
<li>
<p><code>childTrieKey</code> (optional): String containing the hexadecimal-encoded key of the child trie of the &quot;default&quot; namespace if the storage entry is part of a child trie. If the storage entry is part of the main trie, this field is not present.</p>
</li>
</ul>
<h3 id="storagediffdone"><a class="header" href="#storagediffdone">storageDiffDone</a></h3>
<pre><code class="language-json">{
    &quot;event&quot;: &quot;storageDiffDone&quot;,
}
</code></pre>
<p>This event is always generated after all <code>storageDiff</code> events have been generated.</p>
<p>No more events will be generated after a <code>storageDiffDone</code> event.</p>
<h3 id="storagedifferror"><a class="header" href="#storagedifferror">storageDiffError</a></h3>
<pre><code class="language-json">{
    &quot;event&quot;: &quot;storageDiffError&quot;,
    &quot;error&quot;: &quot;...&quot;,
}
</code></pre>
<p><code>error</code> is a human-readable error message indicating why the call has failed. This string isn't meant to be shown to end users, but is for developers to understand the problem.</p>
<p>No more events will be generated after a <code>storageDiffError</code> event.</p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>This function calculates the storage difference between two blocks. The storage difference is calculated by comparing the storage of the <code>previousHash</code> block with the storage of the <code>hash</code> block. If the <code>previousHash</code> parameter is not provided, the storage difference is calculated between the parent of the <code>hash</code> block and the <code>hash</code> block.</p>
<p>The JSON-RPC server is encouraged to accept at least one <code>archive_v1_storageDiff</code> subscription per JSON-RPC client. Trying to make more calls might lead to a JSON-RPC error when calling <code>archive_v1_storageDiff</code>. The JSON-RPC server must return an error code if the server is overloaded and cannot accept new subscription call.</p>
<p>Users that want to obtain the storage difference between two blocks should use this function instead of calling <code>archive_v1_storage</code> for each block and comparing the results.
When users are interested in the main trie storage differences, as well as in a child storage difference, they can call this function with <code>items: [ { &quot;returnType&quot;: &quot;value&quot; }, { &quot;returnType&quot;: &quot;value&quot;, &quot;childTrieKey&quot;: &quot;0x...&quot; } ]</code>.</p>
<h2 id="possible-errors"><a class="header" href="#possible-errors">Possible errors</a></h2>
<ul>
<li>A JSON-RPC error can be generated if the JSON-RPC client has to many active calls to <code>archive_v1_storageDiff</code>.</li>
<li>A JSON-RPC error with error code <code>-32602</code> is generated if one of the parameters doesn't correspond to the expected type (similarly to a missing parameter or an invalid parameter type).</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../api/archive_v1_storage.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../api/chainHead.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../api/archive_v1_storage.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../api/chainHead.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
